<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
<script>
  <% if (data && data.posts) { %>
  let posts = <%- JSON.stringify(data.posts) %>
  <% } else { %>
  let posts = null
  <% } %>
  let postContainers = {}
  let quillConverterContainer = document.createElement('div')
  let quillConverter = new Quill(quillConverterContainer)

  function setPost(container, idx) {
    let titleElement = document.getElementById('post-title-' + container)
    let infoElement = document.getElementById('post-info-' + container)
    let textElement = document.getElementById('post-text-' + container)

    if (posts != null && posts[container].length != 0) {
      let post = posts[container][idx]
      titleElement.innerHTML = post.title
      infoElement.innerHTML = "CDT " + post.author.toUpperCase() + " - " + post.date
      quillConverter.setContents(JSON.parse(post.text))
      textElement.innerHTML = quillConverter.root.innerHTML
      if (container in postContainers)
        postContainers[container]['curPost'] = idx
      else
        postContainers[container] = { 'curPost': idx, 'numPosts': posts[container].length }
      
      let nextButton = document.getElementById('next-' + container)
      let prevButton = document.getElementById('prev-' + container)

      if (postContainers[container]['numPosts'] > idx + 1) nextButton.hidden = false
      else nextButton.hidden = true

      if (idx > 0) prevButton.hidden = false
      else prevButton.hidden = true
    } else {
      titleElement.innerHTML = "No Posts To Display"
      textElement.innerHTML = "Use the staff tools to write your first post."
    }
  }

  function next(container) {
    if (postContainers[container]['numPosts'] > postContainers[container]['curPost'] + 1) {
      setPost(container, ++postContainers[container]['curPost'])
    }
  }

  function previous(container) {
    if (postContainers[container]['curPost'] > 0) {
      setPost(container, --postContainers[container]['curPost'])
    }
  }
</script>